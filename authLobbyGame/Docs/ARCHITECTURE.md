# 시스템 아키텍처

## 전체 흐름

```
[Client]
   ↓ (HTTP)
[인증 서버] → 토큰 발급
   ↓
[Client]
   ↓ (TCP + 토큰)
[로비 서버] → 방 배정
   ↓
[Client]
   ↓ (TCP/UDP)
[게임 서버] → 게임 세션
```

## 서버 간 통신

### 인증 서버 ↔ 로비 서버
- **방향**: 로비 → 인증
- **목적**: 토큰 검증
- **프로토콜**: HTTP API 또는 TCP

### 로비 서버 ↔ 게임 서버
- **방향**: 양방향
- **목적**:
  - 로비 → 게임: 세션 시작, 플레이어 정보 전달
  - 게임 → 로비: 게임 종료, 결과 전송
- **프로토콜**: TCP

## 클라이언트 연결 프로세스

### 1단계: 인증
1. 클라이언트가 인증 서버에 로그인 요청 (HTTP POST)
2. 인증 서버가 자격 증명 검증
3. 성공 시 JWT 토큰 발급

### 2단계: 로비 진입
1. 클라이언트가 로비 서버에 TCP 연결
2. 토큰을 포함한 연결 요청 전송
3. 로비 서버가 인증 서버에 토큰 검증 요청
4. 검증 성공 시 로비 입장

### 3단계: 게임 매칭
1. 클라이언트가 게임 참가 요청
2. 로비 서버가 매칭 또는 방 생성
3. 게임 서버 할당 및 접속 정보 전달

### 4단계: 게임 플레이
1. 클라이언트가 게임 서버에 TCP 연결
2. UDP 채널 설정 (ENet)
3. 게임 세션 시작
4. TCP: 중요 이벤트, UDP: 실시간 동기화

## 확장성 고려사항

### 로드 밸런싱
- 여러 게임 서버 인스턴스 실행 가능
- 로비 서버가 부하에 따라 게임 서버 선택

### 장애 대응
- 각 서버 독립적 재시작 가능
- 게임 서버 다운 시 로비에서 재배정

### 상태 관리
- 인증 서버: Stateless (토큰 기반)
- 로비 서버: 유저 목록, 방 정보
- 게임 서버: 게임 세션 상태
