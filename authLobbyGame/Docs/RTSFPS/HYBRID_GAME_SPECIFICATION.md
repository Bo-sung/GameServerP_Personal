# FPS/RTS 하이브리드 게임 명세서 (HYBRID_GAME_SPECIFICATION)

## 1. 게임 기본 정보

### 1.1 게임 개요
```
프로젝트명: TBD (예: Squad Commander, Asymmetric Warfare)
장르: 비대칭 멀티플레이어 (FPS + RTS 하이브리드)
타겟 플랫폼: PC (Windows/Linux)
플레이어 구성: 4인 FPS + 1인 RTS (총 5인)
게임 지속 시간: 15~25분
```

### 1.2 핵심 컨셉
```
"소수 정예 vs 물량 전략 전투"

• FPS 스쿼드: 협력하는 정예 팀, 전술적 플레이 강조
• RTS 커맨더: 대량 유닛 지휘, 전략적 사고 강조
• 상호작용: 커맨더의 명령이 게임 흐름을 결정
```

---

## 2. 게임 모드

### 2.1 기본 모드: AI 군단 제거전 (Squad Elimination)

#### 게임 규칙
```
맵 크기: 1km × 1km (256 × 256 타일, 32px/타일)
게임 시간: 20분 (또는 최초 조건 달성)
난이도: Easy / Normal / Hard (AI 명중률/전술 조정)
```

#### FPS 스쿼드 승리 조건 (3가지 중 1개)
1. **전멸 승리**: 100개 AI 유닛 모두 처치
2. **생존 승리**: 20분 생존 (게임 끝날 때까지)
3. **임무 승리**: 특정 목표 달성 (선택적 미션)

```
점수 시스템:
• AI 처치: +10점
• 헤드샷: +15점
• 팀킬: -50점
• 데스: 점수 불감소 (RTS와 다르게)
```

#### RTS 커맨더 승리 조건
1. **전멸 승리**: 4인 스쿼드 모두 제거
   - 스쿼드 전원 데스 = 즉시 승리
   - 상대 선택: 항복 불가능

#### 리스폰 시스템
```
FPS 스쿼드:
• 첫 데스: 즉시 리스폰 (최대 5회)
• 전원 데스: 팀 생존 불가, 10초 후 RTS 승리

RTS 커맨더:
• 데스 불가능 (유닛 조종 불가)
• 접사 당할 수 있음 (커맨더 실패)
```

### 2.2 선택적 모드: 미션 기반 (Mission Based)

```
미션 예시:
1. 레이더 기지 파괴 (목표 위치 도달)
2. 문서 수집 (여러 포인트 방문)
3. VIP 보호 (NPC 이동 호위)
4. 자원 확보 (특정 지역 점령)

점수:
• 미션 달성: +100점
• 생존 시간: 1분당 +5점
```

---

## 3. FPS 스쿼드 플레이

### 3.1 플레이어 클래스 (4인 팀)

#### 클래스 구성
```
1. 리더 (Squad Leader)
   - 기본 소총 (AR)
   - 팀 명령 권한 (호출, 치료)
   - 특수 능력: 아군 체력 표시

2. 의무병 (Medic)
   - 권총 + 의료킷
   - 아군 회복 능력
   - 특수 능력: 범위 회복

3. 엔지니어 (Engineer)
   - 권총 + 로켓런처/유탄
   - 객체 파괴 (장애물, 포탑)
   - 특수 능력: 2초 빠른 재장전

4. 스나이퍼 (Sniper)
   - 저격총 + 권총
   - 원거리 지원
   - 특수 능력: 일시적 줌 시야 증가
```

### 3.2 무기 시스템

#### 무기 특성
```
소총 (AR):
• 데미지: 25/헤드샷 50
• 연사력: 800 RPM
• 정확도: 중간
• 탄약: 무제한

권총:
• 데미지: 15/헤드샷 30
• 연사력: 300 RPM
• 정확도: 낮음
• 탄약: 무제한

저격총:
• 데미지: 80/헤드샷 150
• 연사력: 60 RPM
• 정확도: 높음
• 탄약: 무제한

로켓런처:
• 데미지: 100 (폭발)
• 연사력: 30 RPM
• 정확도: 낮음
• 탄약: 무제한
```

### 3.3 체력 및 상태

#### 플레이어 상태
```
최대 체력: 100 HP
초기 체력: 100 HP (스폰 시)

회복:
• 의료킷: +40 HP (3초 채널링)
• 자동 회복: 없음 (의료병만 회복 가능)

데스:
• 체력 <= 0 시 사망
• 3초 후 자동 리스폰
• 최대 5회 리스폰 가능
```

#### 상태 이상
```
제압 (Suppression):
• 지속적 피격 시 정확도 -30%
• 이동속도 -50%
• 5초 이상 회복 불가

무기 손상:
• 적 화염 접촉 시 5초간 무기 사용 불가

출혈:
• 치명상 후 10초 내 회복 불가 시 사망
```

---

## 4. RTS 커맨더 플레이

### 4.1 커맨더 인터페이스

#### 화면 구성
```
탑다운 뷰:
• 맵 스케일: 1:32 (32 픽셀 = 1미터)
• 카메라 높이: 맵 중앙 상공 200 유닛
• 줌: 0.5배 ~ 2배 가능

UI 요소:
• 아군 유닛: 초록색 아이콘
• 적 스쿼드: 빨간색 아이콘
• 엄폐물: 갈색 선
• 미니맵: 화면 우측 하단 (512x512 px)
```

#### 선택 시스템
```
단일 선택: 유닛 클릭
다중 선택: 드래그 박스 (자동 모두 선택)
전체 선택: Ctrl+A (전체 100개 유닛)
```

### 4.2 명령 시스템

#### 가능한 명령 (최소한)
```
1. 이동 명령 (Move)
   - 우클릭 → 목표 지점 지정
   - 자동 경로 찾기 (A*)
   - 이동 중 적 발견 시 자동 교전

2. 공격 명령 (Attack)
   - Shift+우클릭 → 목표 지정
   - 이동하며 공격
   - 시야 밖 목표는 불가능

3. 정지 명령 (Stop)
   - Spacebar 또는 오른쪽 클릭
   - 현재 명령 취소
   - 유휴 상태로 전환
```

#### 불가능한 명령
```
❌ 컨트롤 그룹 (Ctrl+1~9)
❌ 스탠스 변경 (공격적/수비적)
❌ 엄폐 위치 지정
❌ 특수 능력
❌ 건설/생산 (AI 스포너)

이유: RTS 인터페이스 최소화로 학습곡선 낮춤
```

### 4.3 그룹 명령 시스템 (Phase 1 + 2)

#### Phase 1: 기본 그룹 명령 (MVP)
```
선택된 여러 봇에게 동일 명령 실행

구현 방식:
1. 드래그 박스로 여러 봇 선택 (예: 봇 1~10)
2. 우클릭 → 목표 지점 지정
3. 각 봇이 개별 A* 경로 계산해서 이동
   - 대형 유지 안 함
   - 각자 독립적으로 목표점 도달

예시:
┌─────────────────────────────┐
│     선택된 봇들: 1~10       │
│   우클릭 → 이동 명령        │
│                             │
│  봇1────── ➜ 목표점         │
│  봇2────── ➜ 목표점         │
│  봇3────── ➜ 목표점         │
│  ...                        │
└─────────────────────────────┘

장점:
✓ 구현이 간단 (이미 대부분 완성됨)
✓ 직관적 UI
✓ 즉시 사용 가능

제약:
• 대형 유지 안 됨
• 봇들이 서로 부딪힐 수 있음
```

#### Phase 2: 단순 포메이션 (느슨한 대형)
```
선택된 봇들이 리더 중심으로 느슨한 원형 유지

구현 방식:
1. 첫 번째 선택된 봇 = 리더
2. 나머지 = 팔로워
3. 리더가 이동하면 팔로워 자동 따라옴
4. 각 팔로워는 리더 주변 2m 반경에 유지

UI 변화:
• 선택 모드에서 리더 강조 표시 (밝은 색)
• 팔로워는 일반 색
• 포메이션 버튼 추가:
  ① 기본 (선택 해제 가능)
  ② 포메이션 모드 ON (자동 대형 유지)

예시:
기본 모드 (Phase 1):
  봇1──┐
  봇2─┼─➜ 목표점
  봇3──┤
  봇4──┘

포메이션 모드 (Phase 2):
     봇2
    ╱ ║ ╲
  봇3-[리더]-봇1
   ╲ ║ ╱
     봇4
      ↓
   모두 따라감 (원형 유지)

코드 추가:
• GroupFormation 클래스 (~50줄)
• RTSCommand에 FormationMode 플래그 추가
• UI에 포메이션 토글 버튼

장점:
✓ 시각적으로 보기 좋음
✓ 대형 유지로 부딪힘 감소
✓ 전술적 느낌 추가
✓ 구현이 여전히 간단

제약:
• 대형이 느슨함 (원형만 지원)
• 좁은 통로에서 막힘 가능
```

#### 포메이션 모드 상세

**ON/OFF 토글**
```
UI 위치: RTS 클라이언트 우측 상단
┌─────────────────┐
│ [기본] [포메이션] │  ← 토글 버튼
└─────────────────┘

• [기본]: Phase 1 (개별 이동)
• [포메이션]: Phase 2 (대형 유지)
```

**리더 선택 규칙**
```
1. 가장 먼저 선택한 봇 = 리더
2. 리더 재선택 가능
   - Shift+클릭으로 새 리더 지정
3. 리더 사망 시 다음 봇이 자동 리더 승격
```

**포메이션 재배치**
```
리더가 이동할 때:
• 각 팔로워의 상대 위치 유지
• 장애물 만나면 일시적으로 흩어짐
• 장애물 통과 후 다시 모임

거리 계산:
• 각 팔로워: 리더로부터 2m 거리 유지
• 각도: (360도 / 팀원수) × 순번

예 (봇 5개 팀):
  봇2 (72도)
 ╱ ║ ╲
봇3─리더─봇1 (0도)
 ╲ ║ ╱
  봇4 (144도)
```

**전투 중 포메이션 동작**
```
상황: 리더가 적 발견 → Combat 상태

동작:
1. 리더: 적 공격
2. 팔로워: 계속 리더 따라가기 (원형 유지)
3. 팔로워도 적 시야에 들어오면 자동 공격
4. 제압받으면 엄폐물로 흩어질 수 있음 (자동 AI)

결과: 자연스러운 팀 전투 형태
```

---

## 5. Bot AI 시스템

### 5.1 AI 상태 머신 (FSM)

#### 상태 종류
```
Patrol (순찰):
• 명령 없을 때 기본 상태
• 주변 일꾼 따라가기
• 무작위 경로 순찰

Investigate (조사):
• 총소리/시체 발견
• 3초간 그 방향으로 이동
• 위협 발견 시 Combat 전환

Combat (전투):
• 적 발견 시 전환
• 2초 후 측면 회피 시도
• 체력 < 30% 시 후퇴

TacticalRetreat (후퇴):
• 체력 낮음 또는 제압됨
• 엄폐물로 이동
• 아군과 만나면 재집결

Healing (회복):
• 안전 지역에서 자가 회복
• 초당 2 HP 회복 (최대 60초)
• 회복 완료 또는 피격 시 종료
```

### 5.2 명중률 시스템

#### 교전 반응
```
초기 반응: 0.2~0.5초 (피격 후 응사)
반응 거리: 공격 방향 ±30도 범위

명중률 조정:
• 0~1초: 10% (패닉)
• 1~3초: 25% (적 파악)
• 3~5초: 50% (조준 개선)
• 5초+: 75% (완전 집중)

리셋 조건:
• 시야 상실 후 3초 경과
• 다른 적으로 전환
```

### 5.3 제압 시스템 (Suppression)

```
Suppression Level:
0~30%: 정상 명중률
30~60%: -10% 명중률, -20% 이동속도
60~90%: -20% 명중률, -30% 이동속도
90~100%: -30% 명중률, -50% 이동속도, 강제 엄폐

제압 증가:
• 집중 사격 3초: +30% → 경미
• 집중 사격 6초: +30% → 중간
• 집중 사격 10초: +30% → 심각

제압 감소:
• 초당 5% 자동 감소
• 엄폐 중: 초당 10% 감소
```

### 5.4 개별 Bot 특성 (다양성)

```
각 Bot마다 랜덤 할당:

공격성 (Aggression): 50~150%
• 낮음: 거리 유지, 신중
• 높음: 빠른 접근, 공격적

정확도 (Accuracy Bonus): 0~50%
• 경험 많은 Bot: 더 정확함
• 신병: 부정확함

용감성 (Courage): 30~100%
• 낮음: 쉽게 후퇴
• 높음: 마지막까지 저항
```

---

## 6. 비대칭 밸런싱

### 6.1 어려움 레벨

#### Easy (초보자)
```
Bot AI 명중률: × 0.6 (초기: 6%, 최대: 45%)
Bot 반응 시간: + 0.5초 (지연)
Bot 개수: 50개 (절반)
FPS 스쿼드 체력: × 1.2 (120 HP)

예상 승률: FPS 70%
게임 난이도: 5/10
```

#### Normal (중간)
```
Bot AI 명중률: × 1.0 (초기: 10%, 최대: 75%)
Bot 반응 시간: 기본 (0.2~0.5초)
Bot 개수: 100개
FPS 스쿼드 체력: 100 HP

예상 승률: FPS 50%
게임 난이도: 7/10
```

#### Hard (어려움)
```
Bot AI 명중률: × 1.4 (초기: 14%, 최대: 105% → 캡 75%)
Bot 반응 시간: - 0.2초 (빠름)
Bot 개수: 150개
FPS 스쿼드 체력: 80 HP
Bot 제압 저항: + 20%

예상 승률: FPS 30%
게임 난이도: 9/10
```

### 6.2 밸런싱 메트릭

```
목표 게임 타임: 18분
목표 FPS 승률: 45~55% (균형잡힌 게임)

추적 지표:
• 평균 게임 지속 시간
• FPS vs Bot 승률
• 평균 FPS 팀 점수
• 평균 Bot 처치 수
• 평균 FPS 사망 수
```

---

## 7. 점수 시스템

### 7.1 FPS 스쿼드 점수

```
행동별 점수:
• AI 처치: +10점
• 헤드샷: +15점 (대신 +10 아님)
• 지원 (의료병 회복): +5점
• 지원 (엔지니어 파괴): +8점
• 미션 달성: +100점

패널티:
• 팀킬: -50점
• 데스: 0점 (패널티 없음)
• 항복: -100점
```

### 7.2 RTS 커맨더 점수

```
행동별 점수:
• AI 처치 성공: +1점/유닛
• 전술 우수 (측면 공격): 보너스 +50점
• 전멸 승리: +500점
• 시간 내 소탕: +100점 (분 × 10)

예시:
• 20분에 75/100 유닛 처치: 75 + (20×10) = 275점
• 15분 내 100/100 처치: 100 + 200 + 500 = 800점
```

---

## 8. 게임 플로우

### 8.1 게임 시작 (Warmup: 0~2분)

```
1. 로비 서버: 플레이어 매칭 (4 FPS + 1 RTS)
2. 게임 서버: 게임 초기화
   - 맵 로드
   - 팀 배정
     * Team A: 4인 FPS 스쿼드 (Red)
     * Team B: 100개 Bot + 1인 RTS (Blue)
   - 각 플레이어에게 스폰 위치 할당
3. 클라이언트: 맵 로드 완료 확인
4. 서버: "게임 시작 대기" 상태 유지 (2분)
   - 플레이어들이 맵 로드할 시간 제공
   - 이 동안 Bot은 순찰만 함
```

### 8.2 게임 진행 (InProgress: 2~20분)

```
매 틱 (1/100초, 10ms):
1. FPS 클라이언트 입력 수집 (60Hz → 10ms 업데이트 간격 맞춤)
2. Unreal 서버:
   - 플레이어 이동 처리
   - 피격 판정
   - Bot 물리 업데이트
3. C# Bot Controller:
   - 개별 Bot AI 루프 (30Hz)
   - 명령 처리
   - 상태 업데이트
4. 동기화 전송
   - Unreal → C# Bot 상태 (30Hz)
   - C# Bot → RTS UI 상태 (10Hz)
5. 게임 상태 확인
   - 시간 확인: 20분 경과?
   - 승리 조건 확인:
     * FPS: 100/100 Bot 처치?
     * RTS: 4/4 FPS 플레이어 처치?
```

### 8.3 게임 종료 (Finished)

```
승리 조건 검출:
1. FPS 스쿼드 승리
   - 모든 Bot 처치 (100/100)
   - 또는 20분 생존
2. RTS 커맨더 승리
   - 모든 FPS 플레이어 처치 (4/4)

게임 종료 절차:
1. 승자 결정
2. 최종 통계 수집
3. 점수 계산
4. 데이터베이스 저장
5. 클라이언트에 결과 전송
6. 로비로 복귀 (30초 준비)
```

---

## 9. 네트워크 동기화

### 9.1 동기화 대상

```
Unreal 서버:
• FPS 플레이어 위치/회전 (60Hz, UDP)
• Bot 위치/체력/상태 (30Hz, Unreal Replication)

C# Bot 컨트롤러:
• Bot 상태 (위치, 체력, 상태) ← Unreal (30Hz)
• Bot 입력 (이동, 공격) → Unreal (30Hz)
• RTS 커맨더 명령 ← RTS 클라이언트
• RTS 커맨더 뷰 데이터 → RTS 클라이언트 (10Hz)
```

### 9.2 지연 보정 (Latency Compensation)

```
클라이언트 예측:
• FPS: 로컬 이동 즉시 렌더링
• RTS: 명령 즉시 반영 (서버 확인 대기)

서버 보정:
• Bot 이동: 예측 경로 vs 서버 실제 경로
• 충돌: 서버가 최종 결정
• 피격: 과거 위치 기록으로 공정성 보장
```

---

## 10. 특수 메커니즘

### 10.1 팀워크 (FPS 스쿼드)

```
리더 능력:
• 호출: 아군 위치 UI 표시 (항상 가능)
• 치료 호출: 의료병을 특정 위치로 소환

의료병 능력:
• 회복: 근처 아군 +40 HP
• 응급 처치: 출혈 상태 제거

엔지니어 능력:
• 폭파: 아이템/장애물 파괴
• 빠른 재장전: 2초 빠름

스나이퍼 능력:
• 줌: 순간적으로 시야 2배 확대
```

### 10.2 상황 인식 (RTS 커맨더)

```
RTS 정보:
• 실시간 Bot 위치 (탑다운)
• Bot 전투 상태 표시
• 미니맵 조감도
• 경보: "적 발견" 알림 (음성/텍스트)

전술 정보:
• 적 분포 추정 (추측)
• 최후의 Bot 위치
• 시간 카운트
```

---

## 11. 테스트 시나리오

### 11.1 기능 테스트

```
[테스트 1] 기본 이동
- FPS: 이동 키 입력 → 동기화 확인
- RTS: 유닛 선택 → 이동 명령 → 실행 확인

[테스트 2] 전투
- FPS: 발사 → Bot 데미지 → 동기화
- Bot: 피격 → 반격 → 제압 증가

[테스트 3] 게임 종료
- FPS 승리: 100개 Bot 처치
- RTS 승리: 4명 FPS 모두 제거
```

### 11.2 성능 테스트

```
[테스트] 100개 Bot 동시 AI 루프
- C# 서버 CPU 사용률 < 50%
- 메모리 사용률 < 2GB
- 네트워크 대역폭 < 150 KB/s
```

---

## 12. 그룹 명령 구현 체크리스트

### Phase 1: 기본 (필수)
```
✓ RTS 클라이언트에서 다중 유닛 선택 UI
✓ 선택된 유닛 목록 저장 (List<int> selectedBotIds)
✓ 우클릭 → RTSCommand 생성
✓ 모든 선택 유닛에 동일 명령 전송
✓ C# Bot Controller: 각 봇별 경로 계산 (A*)
✓ Unreal: 각 봇 개별 이동 처리

예상 소요 시간: 0분 (이미 대부분 구현됨)
```

### Phase 2: 포메이션 (추가)
```
❑ GroupFormation 클래스 생성
  - leaderBotId: 리더 봇 ID
  - followerBotIds: 팔로워 ID 목록
  - UpdateFormation(): 리더 위치 기반 팔로워 배치
  
❑ RTSCommand 확장
  - bool UseFormation: 포메이션 모드 활성화
  - int LeaderBotId: 리더 지정
  
❑ BotAgent 확장
  - Vector3 FormationOffset: 상대 위치
  - FollowLeader(Vector3 leaderPos, Vector3 offset): 리더 따라가기
  
❑ RTS UI
  - [기본] [포메이션] 토글 버튼
  - 선택된 봇 중 리더 표시 (색상 강조)
  
❑ 테스트
  - 5개 봇 선택 → 포메이션 모드 ON
  - 리더 이동 → 팔로워 원형 유지 확인
  - 전투 상황에서 원형 유지 확인

예상 소요 시간: 30분
코드 추가: ~50줄
```

---

## 13. 참고 게임

```
• Company of Heroes 2: 전술적 전투, 엄폐 시스템, 포메이션
• Natural Selection 2: FPS+RTS 하이브리드 구조
• Evolve: 4v1 비대칭 밸런싱
• Squad: 팀워크 기반 게임플레이, 분대 시스템
• Escape from Tarkov: Scav AI 행동
```

